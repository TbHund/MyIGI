{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'main/css/pages/home.css' %}">
{% endblock %}

{% block title %}Главная - Отель{% endblock %}

{% block content %}
<section class="block-widget" id ="pageTop">
    <article class="time-info">
        <h3>Информация о времени</h3>
        <div class="time-details">
            <p><strong>Ваша временная зона:</strong> {{ user_timezone }}</p>
            <p><strong>Текущее время:</strong> {{ current_time }}</p>
            <p><strong>UTC время:</strong> {{ utc_time }}</p>
        </div>
    </article>
    
    <article class="calendar-widget">
        <h3>Календарь</h3>
        <pre>{{ calendar }}</pre>
    </article>

    <article class="latest-changes">
        <h3>Последние изменения</h3>
        {% if latest_changes.bookings %}
        <p><strong>Последнее бронирование:</strong> {{ latest_changes.bookings.updated_at|date:"d/m/Y H:i" }}</p>
        {% endif %}
        {% if latest_changes.reviews %}
        <p><strong>Последний отзыв:</strong> {{ latest_changes.reviews.created_at|date:"d/m/Y H:i" }}</p>
        {% endif %}
        {% if latest_changes.news %}
        <p><strong>Последняя новость:</strong> {{ latest_changes.news.created_at|date:"d/m/Y H:i" }}</p>
        {% endif %}
    </article>
</section>

<section class="banner" style="max-width: 500px; text-align: center; padding: 20px 0; background: linear-gradient(135deg, #87CEEB 0%, #B0E0E6 50%, #ADD8E6 100%); color: white;">
    <img src="{% static 'main/images/amogus.jpg' %}" 
         alt="Trivago Hotel" 
         height="200"
         width="300"
         title="Реклама"
         style="border-radius: 10px; box-shadow: 0 8px 16px rgba(0,0,0,0.3);">
</section>
<a href="#n1">См. список наших партнеров</a>

<div class="main-container">
    {% if latest_news %}
    <div class="news-alert">
        <h4>{{ latest_news.title }}</h4>
        <p>{{ latest_news.content|truncatewords:50 }}</p>
        <a href="{% url 'news_detail' latest_news.pk %}" class="button button-info">Читать далее</a>
    </div>
    {% endif %}

    <div class="content-wrapper">
        <aside class="sidebar">
            <div class="filter-card">
                <h5 class="filter-title">Фильтры поиска</h5>
                <form method="get" class="filter-form">
                    <div class="form-group">
                        <label for="category">Категория номера:</label>
                        <select name="category" id="category">
                            <option value="">Все категории</option>
                            {% for category in categories %}
                            <option value="{{ category.slug }}" {% if selected_category == category.slug %}selected{% endif %}>
                                {{ category.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="capacity">Минимальная вместимость:</label>
                        <input type="number" name="capacity" id="capacity" 
                               value="{{ selected_capacity }}" min="1" max="10">
                    </div>
                    <div class="form-group">
                        <label for="check_in">Дата заезда:</label>
                        <input type="date" name="check_in" id="check_in" 
                               value="{{ check_in }}" required>
                    </div>
                    <div class="form-group">
                        <label for="check_out">Дата выезда:</label>
                        <input type="date" name="check_out" id="check_out" 
                               value="{{ check_out }}" required>
                    </div>
                    <button type="submit" class="button button-primary">Найти номера</button>
                </form>
            </div>
        </aside>

        <div class="main-content">
            <h2 class="content-title">Наши номера</h2>
            {% if rooms %}
            <div class="rooms-grid">
                {% for room in rooms %}
                <div class="room-card">
                    {% if room.image %}
                    <div class="room-image-container">
                        <img src="{{ room.image.url }}" class="room-image" alt="{{ room.number }}">
                    </div>
                    {% endif %}
                    <div class="room-details">
                        <h5 class="room-title">Номер {{ room.number }}</h5>
                        <div class="room-info">
                            <p><strong>Категория:</strong> {{ room.category.name }}</p>
                            <p><strong>Вместимость:</strong> {{ room.capacity }} чел.</p>
                            <p><strong>Цена за ночь:</strong> {{ room.price_per_night }} руб.</p>
                        </div>
                        <p class="room-description">{{ room.description|truncatewords:30 }}</p>
                        {% if check_in and check_out %}
                            {% if user.is_authenticated %}
                                <a href="{% url 'book_room' room.id %}?check_in={{ check_in }}&check_out={{ check_out }}" 
                                   class="button button-primary">Забронировать</a>
                            {% else %}
                                <a href="{% url 'login' %}" class="button button-secondary">Войдите для бронирования</a>
                            {% endif %}
                        {% else %}
                            <div class="warning-message-small">
                                Выберите даты для бронирования
                            </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="warning-message">
                К сожалению, на выбранные даты нет свободных номеров.
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!--Якорь-->
<h1><a id ="n1"></a>Наши партнеры</h1>
<section class="block-widget">
    {% for partner in partners %}
        {% if partner.is_active %}
            <a href={{ partner.url }} class="partner-link" target="_blank">
                <figure class="partner-figure">
                    <img src= {{ partner.logo.url}} class="partner-logo">
                    <figcaption class="partner-caption">{{ partner.title}}</figcaption>
                </figure>
            </a>
        {% endif %}
    {% endfor %}
</section>
{% endblock %} 

{% block js_scripts %}
    <script src="{% static 'main/js/pages/home/date.js' %}"></script>
{% endblock %}